<!DOCTYPE html>
<html>
<head>
    <title>Список сотрудников</title>
    <style>
        .search-box { margin-bottom: 20px; }
        select { min-width: 150px; padding: 5px; }
        .manager-form { display: flex; gap: 5px; align-items: center; }
        .flash-message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .flash-success { background-color: #dff0d8; color: #3c763d; }
        .flash-danger { background-color: #f2dede; color: #a94442; }
    </style>
</head>
<body>
    <h1>Список сотрудников</h1>
    <!-- Flash-сообщения -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash-message flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}    
    <!-- Форма поиска -->
    <div class="search-box">
        <form action="/" method="get">
            <input type="text" name="search" value="{{ search_query }}" placeholder="Поиск по ФИО">
            <input type="hidden" name="sort" value="{{ sort_field }}">
            <input type="hidden" name="order" value="{{ order }}">
            <button type="submit">Найти</button>
            {% if search_query %}
                <a href="?sort={{ sort_field }}&order={{ order }}">Сбросить</a>
            {% endif %}
        </form>
    </div>
    
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>ФИО</th>
                <th>Должность</th>
                <th>Дата приёма</th>
                <th>Зарплата</th>
                <th>Начальник</th>
                <th>Изменить начальника</th>
            </tr>
        </thead>
        <tbody>
            {% if employees %}
                {% for employee in employees %}
                    <tr>
                        <td>{{ employee.id }}</td>
                        <td>{{ employee.full_name }}</td>
                        <td>{{ employee.post }}</td>
                        <td>{{ employee.hire_date }}</td>
                        <td>{{ employee.salary }}</td>
                        <td>{{ employee.manager.full_name if employee.manager else 'Нет' }}</td>
                        <td>
                          <form class="manager-form" action="{{ url_for('update_manager', employee_id=employee.id) }}" method="post">
                            <select name="manager_id">
                                <option value="None">-- Без начальника --</option>
                                {% for emp in all_employees if emp.id != employee.id %}
                                    <option value="{{ emp.id }}" {% if employee.manager_id == emp.id %}selected{% endif %}>
                                        {{ emp.full_name }} ({{ emp.post }})
                                    </option>
                                {% endfor %}
                            </select>
                            <button type="submit">Изменить</button>
                          </form>
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</body>
</html>